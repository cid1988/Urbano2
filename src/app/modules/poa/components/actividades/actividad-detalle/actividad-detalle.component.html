<div class="container" *ngIf="actividad">
  <div class="card" style="margin-bottom: 20px">
    <div class="card-header" style="color: white; background-color:cadetblue; opacity: 0.5">
      <div class="col-12">
        <button type="button" class="btn btn-outline-light float-right" style="margin-left: 5px" routerLink="../../../.." [hidden]="editando"><i class="fa fa-arrow-left"></i> Volver</button>
        <button type="button" class="btn btn-outline-light float-right" [hidden]="editando" (click)="editando = true">Editar</button>
        <button type="button" class="btn btn-outline-light float-right" [disabled]="!actividadForm.valid" [hidden]="!editando" (click)="guardar(actividadForm)">Guardar</button>
        <button type="button" class="btn btn-outline-light float-right" style="margin-right: 5px" [hidden]="!editando" (click)="editando = false">Cancelar</button>
        <button type="button" class="btn btn-outline-danger float-right" style="margin-right: 5px" (click)="eliminarActividad()" [hidden]="!editando">Eliminar</button>
      </div>
      <small>Plan - Area Proyecto</small>
    </div>
  </div>
  <!-- {{filtro.plan.anio}} - {{filtro.area.nombre}} - {{filtro.proyecto.nombre}}
  <div class="row" style="margin-bottom: 20px">
    <div class="col-12">
      <button type="button" class="btn btn-outline-primary float-right" style="margin-left: 5px" routerLink="../../../.." [hidden]="editando"><i class="fa fa-arrow-left"></i> Volver</button>
      <button type="button" class="btn btn-outline-primary float-right" [hidden]="editando" (click)="editando = true">Editar</button>
      <button type="button" class="btn btn-outline-primary float-right" [disabled]="!actividadForm.valid" [hidden]="!editando" (click)="guardar(actividadForm)">Guardar</button>
      <button type="button" class="btn btn-outline-primary float-right" style="margin-right: 5px" [hidden]="!editando" (click)="editando = false">Cancelar</button>
      <button type="button" class="btn btn-outline-danger float-right" style="margin-right: 5px" (click)="eliminarActividad()" [hidden]="!editando">Eliminar</button>
    </div>
  </div> -->
  <form (ngSubmit)="onSubmit(actividadForm)" #actividadForm="ngForm" novalidate="">
    <div class="form-row">
      <div class="col-10">
        <div class="form-row">
          <div class="form-group col-6">
            <label for="name">Nombre</label>
            <input type="text" class="form-control" id="name" required [disabled]="!editando" [(ngModel)]="actividad.nombre" name="nombre" #nombre="ngModel">
            <div [hidden]="nombre.valid || nombre.pristine" class="alert alert-danger">
              <div *ngIf="nombre.errors?.required">
                Este campo es requerido.
              </div>
              <!-- <div *ngIf="nombre.errors?.minlength">
                Por lo menos 5 caracteres.
              </div> -->
              <!-- <div *ngIf="nombre.$invalid">
                Dirty
              </div> -->
            </div>
          </div>
          <div class="form-group col-2">
            <label for="codIdentificacion">Nro identificacion</label>
            <input type="text" class="form-control" id="codIdentificacion" [disabled]="!editando" [(ngModel)]="actividad.codIdentificacion" name="codIdentificacion" #codIdentificacion="ngModel">
            <div [hidden]="codIdentificacion.valid || codIdentificacion.pristine" class="alert alert-danger">
              <div *ngIf="codIdentificacion.errors?.required">
                Este campo es requerido.
              </div>
            </div>
          </div>
        </div>
        <div class="form-row"><!--No deberia poder elegirse a si mismo -->
          <div class="form-group col-4">
            <label for="">Predecesor</label>
            <select class="form-control" [disabled]="!editando" [(ngModel)]="actividad.predecesor" name="predecesor" #predecesor="ngModel">
              <option *ngFor="let p of predecesores" [ngValue]="p._id">{{p.nombre}}</option>
            </select>
          </div>
          <div class="form-group col-4">
            <label for="">Etapa</label>
            <select class="form-control" [disabled]="!editando" [(ngModel)]="actividad.etapa" name="etapa" #etapa="ngModel">
              <option *ngFor="let e of etapas" [ngValue]="e._id">{{e.nombre}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-2">
        <button type="button" class="col-12" style="margin-bottom: 5px" [ngClass]="(actividad.inicioCumplido) ? 'btn btn-success': 'btn btn-outline-success'" ngDefaultControl [disabled]="!editando" (click)="(actividad.inicioCumplido) ? actividad.inicioCumplido = false : actividad.inicioCumplido = true" [(ngModel)]="actividad.inicioCumplido" name="inicioCumplido" #inicioCumplido="ngModel">Inicio cumplido</button>
        <button type="button" class="col-12" style="margin-bottom: 5px" [ngClass]="(actividad.cumplida) ? 'btn btn-primary': 'btn btn-outline-primary'" ngDefaultControl [disabled]="!editando" (click)="(actividad.cumplida) ? actividad.cumplida = false : actividad.cumplida = true" [(ngModel)]="actividad.cumplida" name="cumplida" #cumplida="ngModel">Fin cumplido</button>
        <button type="button" class="col-12" style="margin-bottom: 5px" [ngClass]="(actividad.cancelada) ? 'btn btn-secondary': 'btn btn-outline-secondary'" ngDefaultControl [disabled]="!editando" (click)="(actividad.cancelada) ? actividad.cancelada = false : actividad.cancelada = true" [(ngModel)]="actividad.cancelada" name="cancelada" #cancelada="ngModel">Cancelado</button>
        <button type="button" class="col-12" style="margin-bottom: 5px" [ngClass]="(actividad.verEnDashboard) ? 'btn btn-success': 'btn btn-outline-success'" tooltip="Ver en el dashboard del ministro" ngDefaultControl [disabled]="!editando" (click)="(actividad.verEnDashboard) ? actividad.verEnDashboard = false : actividad.verEnDashboard = true" [(ngModel)]="actividad.verEnDashboard" name="verEnDashboard" #verEnDashboard="ngModel">Ver en dashboard</button>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group col-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">Historico
              <button type="button" class="btn btn-outline-primary float-right" [disabled]="!editando" (click)="openModal(false,'')"><i class="fa fa-plus"></i></button>
            </h4>            
          </div>
          <div class="card-body">
            <div *ngFor="let f of actividad.fechas | reverse">
              <div class="row">
                <div class="form-group col-3">
                  <label for="">Fecha inicio</label>
                  <input type="text" class="form-control" disabled [value]="f.fechaInicio">
                </div>
                <div class="form-group col-3">
                  <label for="">Fecha fin</label>
                  <input type="text" class="form-control" disabled [value]="f.fechaFin">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-12">
                  <label for="">Comentarios</label>
                  <textarea class="form-control" rows="2" disabled [value]="f.comentario"></textarea>
                  <small *ngIf="f.fechaCreacion">Creado el {{f.fechaCreacion | date:'dd/MM/yyyy'}}</small>
                </div>
              </div>
              <hr *ngIf="actividad.fechas.length > 1">
            </div>
            <div>Ultima modificacion el {{actividad.fechaActualizacion | date: 'dd/MM/yyyy'}} por {{actividad.usuarioActualizacion}}</div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="modalCrearFecha">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Nueva fecha</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group col-3">
            <label for="">Fecha inicio</label>
            <input type="text" class="form-control" [(ngModel)]="fecha.fechaInicio" name="fechaInicio" #fechaInicio="ngModel">
          </div>
          <div class="form-group col-3">
            <label for="">Fecha fin</label>
            <input type="text" class="form-control" [(ngModel)]="fecha.fechaFin" name="fechaFin" #fechaFin="ngModel">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-12">
            <label for="">Comentarios</label>
            <textarea type="text" class="form-control" [(ngModel)]="fecha.comentario" name="comentario" #comentario="ngModel"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="openModal(true,fecha)">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!--Ejemplo de bootstrap con tres columnas y otra col-12 abajo
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        .col-md-8
        <div class="row">
          <div class="col-md-6">.col-md-6</div>
          <div class="col-md-6">.col-md-6</div>
        </div>
      </div>
      <div class="col-md-4">.col-md-4</div>
    </div>
  </div> -->